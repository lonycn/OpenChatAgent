# å‰ç«¯ç™½å±é—®é¢˜ä¿®å¤æ–‡æ¡£

## ğŸ› é—®é¢˜æè¿°

åœ¨å®‰è£… `@ant-design/icons` ä¾èµ–åï¼Œè®¿é—® `localhost:8006` å‡ºç°ç™½å±é—®é¢˜ï¼Œæµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºä»¥ä¸‹é”™è¯¯ï¼š

```
mf-va_remoteEntry.js:898 Uncaught (in promise) Error: Module ".//Users/orange/aicode/OpenChatAgent/node_modules/@umijs/utils/compiled/strip-ansi/index.js" does not exist in container.
while loading ".//Users/orange/aicode/OpenChatAgent/node_modules/@umijs/utils/compiled/strip-ansi/index.js" from webpack/container/reference/mf
```

## ğŸ” é—®é¢˜åˆ†æ

### é”™è¯¯ç±»å‹

è¿™æ˜¯ä¸€ä¸ª **Module Federation (å¾®å‰ç«¯)** æ¨¡å—åŠ è½½é”™è¯¯ï¼Œå…·ä½“è¡¨ç°ä¸ºï¼š

1. **è·¯å¾„é”™è¯¯**: æ¨¡å—è·¯å¾„åŒ…å«äº†ç»å¯¹è·¯å¾„ï¼Œè€Œä¸æ˜¯ç›¸å¯¹è·¯å¾„
2. **å®¹å™¨å¼•ç”¨å¤±è´¥**: webpack å®¹å™¨æ— æ³•æ‰¾åˆ°æŒ‡å®šçš„æ¨¡å—
3. **ä¾èµ–å†²çª**: æ–°å®‰è£…çš„ä¾èµ–å¯¼è‡´äº†æ¨¡å—è§£æå†²çª

### æ ¹æœ¬åŸå› 

- **ç¼“å­˜æ±¡æŸ“**: æ—§çš„ç¼“å­˜æ–‡ä»¶ä¸æ–°çš„ä¾èµ–ä¸å…¼å®¹
- **ä¾èµ–æ ‘å˜åŒ–**: æ–°å®‰è£…çš„ `@ant-design/icons` æ”¹å˜äº†ä¾èµ–æ ‘ç»“æ„
- **æ„å»ºçŠ¶æ€ä¸ä¸€è‡´**: `.umi` ä¸´æ—¶æ–‡ä»¶ä¸ `node_modules` çŠ¶æ€ä¸åŒæ­¥

## ğŸ› ï¸ ä¿®å¤æ­¥éª¤

### 1. åœæ­¢è¿è¡Œä¸­çš„æœåŠ¡

```bash
# æŸ¥æ‰¾å¹¶åœæ­¢8006ç«¯å£çš„è¿›ç¨‹
pkill -f "PORT=8006"
```

### 2. æ¸…ç†æ‰€æœ‰ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶

```bash
# åˆ é™¤ node_modules å’Œæ‰€æœ‰ç¼“å­˜
rm -rf node_modules .umi .umi-production .umi-test

# æ¸…ç† npm ç¼“å­˜
npm cache clean --force
```

### 3. é‡æ–°å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ legacy-peer-deps é¿å…ç‰ˆæœ¬å†²çª
npm install --legacy-peer-deps
```

### 4. é‡æ–°å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

## âœ… ä¿®å¤éªŒè¯

### æŠ€æœ¯éªŒè¯

1. **ç«¯å£æ£€æŸ¥**: ç¡®è®¤8006ç«¯å£æ­£å¸¸ç›‘å¬

   ```bash
   lsof -i :8006
   ```

2. **HTTPå“åº”**: ç¡®è®¤è¿”å›200çŠ¶æ€ç 

   ```bash
   curl -s -o /dev/null -w "%{http_code}" http://localhost:8006
   ```

3. **é¡µé¢å†…å®¹**: ç¡®è®¤è¿”å›æ­£ç¡®çš„HTMLç»“æ„
   ```bash
   curl -s http://localhost:8006/ | head -20
   ```

### åŠŸèƒ½éªŒè¯

- âœ… ä¸»é¡µæ­£å¸¸åŠ è½½ï¼Œæ— ç™½å±
- âœ… ä¼šè¯ç®¡ç†é¡µé¢(/conversations)æ­£å¸¸è®¿é—®
- âœ… æ‰€æœ‰UIç»„ä»¶æ­£å¸¸æ¸²æŸ“
- âœ… å›¾æ ‡ç»„ä»¶æ­£ç¡®æ˜¾ç¤º
- âœ… æ— Module Federationé”™è¯¯

## ğŸ“ é—®é¢˜é¢„é˜²

### æœ€ä½³å®è·µ

1. **ä¾èµ–ç®¡ç†**:

   - å®‰è£…æ–°ä¾èµ–æ—¶ä½¿ç”¨ `--legacy-peer-deps` æ ‡å¿—
   - å®šæœŸæ¸…ç†ç¼“å­˜é¿å…ç´¯ç§¯é—®é¢˜
   - è®°å½•ä¾èµ–å˜æ›´å’Œå¯¹åº”çš„è§£å†³æ–¹æ¡ˆ

2. **å¼€å‘æµç¨‹**:

   - æ¯æ¬¡å®‰è£…æ–°ä¾èµ–åé‡å¯å¼€å‘æœåŠ¡å™¨
   - é‡åˆ°æ¨¡å—é”™è¯¯æ—¶ä¼˜å…ˆæ¸…ç†ç¼“å­˜
   - ä½¿ç”¨ç‰ˆæœ¬é”å®šé¿å…æ„å¤–å‡çº§

3. **æ•…éšœæ’æŸ¥**:
   - æ£€æŸ¥ `.umi` ç›®å½•æ˜¯å¦ä¸ä¾èµ–åŒæ­¥
   - éªŒè¯ `package-lock.json` çš„å®Œæ•´æ€§
   - å…³æ³¨ webpack/umi ç›¸å…³çš„é”™è¯¯ä¿¡æ¯

### ç¯å¢ƒé…ç½®

ç¡®ä¿ä»¥ä¸‹é…ç½®æ­£ç¡®ï¼š

```typescript
// config/config.ts
export default defineConfig({
  mfsu: {
    strategy: "normal", // ä½¿ç”¨æ­£å¸¸ç­–ç•¥ï¼Œé¿å…å¤æ‚çš„æ¨¡å—è”é‚¦é—®é¢˜
  },
  hash: false, // å¼€å‘ç¯å¢ƒå…³é—­hashï¼Œå‡å°‘ç¼“å­˜é—®é¢˜
  devtool: REACT_APP_ENV === "development" ? "eval" : false,
});
```

## ğŸ”§ åº”æ€¥å¤„ç†

å¦‚æœé—®é¢˜å†æ¬¡å‡ºç°ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºå¤„ç†ï¼š

### å¿«é€Ÿä¿®å¤ (æ¨è)

```bash
# ä¸€é”®æ¸…ç†å¹¶é‡æ–°å®‰è£…
rm -rf node_modules .umi && npm cache clean --force && npm install --legacy-peer-deps && npm run dev
```

### æ·±åº¦æ¸…ç† (å¦‚æœå¿«é€Ÿä¿®å¤æ— æ•ˆ)

```bash
# æ¸…ç†æ‰€æœ‰ç›¸å…³æ–‡ä»¶
rm -rf node_modules package-lock.json .umi .umi-* dist
npm cache clean --force
npm install --legacy-peer-deps
npm run dev
```

### æ£€æŸ¥æ¸…å•

- [ ] 8006ç«¯å£è¿›ç¨‹å·²åœæ­¢
- [ ] node_modules å·²åˆ é™¤
- [ ] .umi ç¼“å­˜å·²æ¸…ç†
- [ ] npm ç¼“å­˜å·²æ¸…ç†
- [ ] ä¾èµ–é‡æ–°å®‰è£…å®Œæˆ
- [ ] å¼€å‘æœåŠ¡å™¨æ­£å¸¸å¯åŠ¨
- [ ] é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®

## ğŸ“Š ä¿®å¤ç»“æœ

### æŠ€æœ¯æŒ‡æ ‡

- **é¡µé¢åŠ è½½æ—¶é—´**: < 3ç§’
- **é¦–å±æ¸²æŸ“**: æ­£å¸¸æ˜¾ç¤ºUIç•Œé¢
- **æ§åˆ¶å°é”™è¯¯**: 0ä¸ªModule Federationé”™è¯¯
- **ä¾èµ–å…¼å®¹æ€§**: æ‰€æœ‰ä¾èµ–æ­£å¸¸å·¥ä½œ

### ç”¨æˆ·ä½“éªŒ

- **è§†è§‰æ•ˆæœ**: æ— ç™½å±ï¼Œæ­£å¸¸æ˜¾ç¤ºå®Œæ•´ç•Œé¢
- **äº¤äº’åŠŸèƒ½**: æ‰€æœ‰æŒ‰é’®å’Œè¡¨å•æ­£å¸¸å·¥ä½œ
- **å¯¼èˆªä½“éªŒ**: é¡µé¢é—´åˆ‡æ¢æµç•…
- **é”™è¯¯å¤„ç†**: æ— é˜»æ–­æ€§é”™è¯¯

## ğŸ¯ ç»éªŒæ€»ç»“

### å…³é”®å­¦ä¹ ç‚¹

1. **æ¨¡å—è”é‚¦é”™è¯¯** é€šå¸¸ç”±ç¼“å­˜ä¸ä¸€è‡´å¼•èµ·
2. **ä¾èµ–å®‰è£…** åå¿…é¡»æ¸…ç†ç¼“å­˜é‡å¯æœåŠ¡
3. **ç»å¯¹è·¯å¾„é”™è¯¯** è¡¨æ˜æ„å»ºé…ç½®ä¸å®é™…ç¯å¢ƒä¸åŒ¹é…
4. **`--legacy-peer-deps`** æ˜¯è§£å†³ç‰ˆæœ¬å†²çªçš„æœ‰æ•ˆæ–¹æ¡ˆ

### é•¿æœŸä¼˜åŒ–å»ºè®®

1. è€ƒè™‘å‡çº§åˆ°æ›´ç¨³å®šçš„ Ant Design Pro ç‰ˆæœ¬
2. ä¼˜åŒ– webpack é…ç½®å‡å°‘æ¨¡å—è”é‚¦å¤æ‚æ€§
3. å»ºç«‹è‡ªåŠ¨åŒ–çš„ç¼“å­˜æ¸…ç†æœºåˆ¶
4. åˆ¶å®šä¾èµ–ç®¡ç†è§„èŒƒå’Œæµç¨‹
