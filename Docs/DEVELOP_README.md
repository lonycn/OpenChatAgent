以下是你当前“AI+人工协同在线客服系统”的完整开发手册（MVP版本），可作为项目全局回顾与技术协作的统一文档：

---

# 🧭 AI 智能客服系统开发手册（MVP 版）

## 一、项目背景

随着 AI 大模型能力的发展，越来越多企业希望通过 AI 实现**客服自动化**，同时保留**人工客服接管能力**以满足复杂对话需求。本项目旨在构建一个：

- 多端接入（网页、小程序、微信公众号）

- 默认 AI 回复，人工可随时接管

- 支持知识库、会话管理、状态切换

- 结构清晰、轻量、易扩展的客服系统

---

## 二、项目目标

| 功能模块    | 核心目标                         |
| ------- | ---------------------------- |
| AI 服务接入 | 使用阿里百炼 MCP API 实现对话/知识库/流程能力 |
| 多端入口    | 支持 Web 页面、小程序、微信公众平台接入       |
| 客服协同    | 人工客服可随时进入会话，自动暂停 AI 回复       |
| 状态控制    | 会话状态（AI / 人工）动态切换、上下文跟踪      |
| 快速部署    | 所有组件均支持本地快速调试、线上部署           |
| 易于迭代    | 可逐步扩展客服后台、知识库管理等模块           |

---

## 三、核心技术选型

| 模块      | 技术                   | 理由                             |
| ------- | -------------------- | ------------------------------ |
| AI 引擎   | ✅阿里百炼（DashScope MCP） | 无需部署，支持对话、知识库、流程插件             |
| 聊天前端 UI | ✅Ant Design X        | 组件丰富，支持 Web/H5/移动端，UI 专为智能对话优化 |
| 后端语言    | Node.js（Express）     | 快速开发，前后端统一语言                   |
| 状态管理    | Redis + SQLite       | Redis 用于实时会话，SQLite 用于开发期记录    |
| 客户端框架   | uniapp               | 一套代码，适配小程序/H5/WebView          |
| 备用客服系统  | Chatwoot（可选）         | 可独立部署，具备客服排队、协同接管等运营能力         |

---

## 四、开源项目参考

| 名称                                                         | 地址          | 说明                           |
| ---------------------------------------------------------- | ----------- | ---------------------------- |
| [Ant Design X](https://github.com/ant-design/ant-design-x) | by 蚂蚁集团     | 智能交互 UI 组件库，适用于 AI 聊天系统      |
| [Chatwoot](https://github.com/chatwoot/chatwoot)           | by Chatwoot | 开源客服系统，可用于人工客服接管             |
| [ChatUI](https://github.com/alibaba/ChatUI)                | by 阿里巴巴     | 聊天 UI 组件库，适用于自建客服界面          |
| [DashScope](https://dashscope.aliyun.com/)                 | 阿里百炼 MCP    | 阿里官方多模态大模型 API 平台，支持知识库+多轮会话 |
| [wechaty](https://github.com/wechaty/wechaty)              | 开源微信 bot 框架 | 支持连接公众号/微信客服系统的消息代理（可选）      |

---

## 五、系统架构概览

```
           客户端（Web/小程序/微信）
                       │
                [ 接入层（WebSocket/API） ]
                       │
                [ 会话控制服务（Node） ]
                ├── 判断接待者（AI / 人工）
                ├── 路由消息
                ├── 会话上下文管理（Redis）
                │
        ┌──────────────┴──────────────┐
        │                             │
  [ AI 接口服务 ]               [ 人工客服系统 ]
（阿里百炼 API）                 （Chatwoot 或自建）
```

---

## 六、开发模块划分（MVP）

| 模块名              | 描述                             | 状态        |
| ---------------- | ------------------------------ | --------- |
| `chat-ui`        | 前端 UI 界面（基于 Ant Design X）      | ✅ 已选型     |
| `chat-core`      | 后端消息转发与状态控制服务（Node.js）         | ✅ 设计中     |
| `ai-service`     | 封装阿里百炼 API（支持知识库/流程）           | ✅ 规划中     |
| `chat-session`   | Redis 中管理当前会话 agent 与上下文       | ✅ 设计中     |
| `chat-admin`（可选） | 人工客服管理界面（Ant Admin / Chatwoot） | ⏳ 后续规划    |
| `chat-client`    | uniapp 客户端接入模块（H5、小程序）         | ✅ 可复用已有组件 |

---

## 七、关键功能流程说明

### 1. 客户发起对话

- 客户通过网页/H5/微信发起会话

- 后端创建 `session_id`，默认接待者为 AI

### 2. AI 回复阶段

- 通过阿里百炼 MCP API 获取 AI 回复

- 支持上传企业知识库（FAQ、文档）并调用

### 3. 客服接管机制

- 客服通过前端界面点击“接管”

- 后端更新 Redis 状态 `agent = human`

- AI 暂停回复，转人工处理

- 客服退出时点击“AI接管”，恢复 AI 接待

### 4. 会话存储

- Redis：记录会话状态（agent）、上下文记录

- SQLite（或 MySQL）：用于开发期持久化保存会话与评分记录

---

## 八、部署与开发环境

| 项目    | 技术栈                  | 环境说明                          |
| ----- | -------------------- | ----------------------------- |
| 前端    | React + Ant Design X | 使用 Vite/Next.js 开发，支持本地调试和构建  |
| 后端    | Node.js + Express    | 使用 pnpm + Redis 本地部署          |
| 移动端   | uniapp               | 支持小程序、H5 打包                   |
| 数据库   | Redis + SQLite       | Redis 用于会话状态，SQLite 用于开发期数据记录 |
| AI 服务 | 阿里百炼 DashScope       | 云 API，需申请 ak/sk，知识库可上传文档      |

---

## 九、下一步建议任务

| 优先级  | 模块            | 动作                                    |
| ---- | ------------- | ------------------------------------- |
| 🔥 高 | `ai-service`  | 完成阿里百炼对话/知识库 API 封装                   |
| 🔥 高 | `chat-core`   | 搭建 WebSocket 服务与状态切换接口（AI/人工）         |
| 🔥 高 | `chat-ui`     | 集成 Ant Design X 聊天 UI，初步对接后端 AI 回复    |
| 🟡 中 | `chat-client` | 实现小程序或微信公众号入口接入（测试版）                  |
| 🟢 低 | `chat-admin`  | 后续实现客服接管后台界面（可用 ant-admin 或 Chatwoot） |

---

## 十、可扩展方向（V1.1+）

- ✅ 多模型支持（OpenAI / 通义 / Claude）

- ✅ 插件能力扩展（工单查询、物流追踪）

- ✅ 用户画像与自动打标签

- ✅ AI 回复满意度评分与纠错标注系统

- ✅ 知识库可视化管理台。


